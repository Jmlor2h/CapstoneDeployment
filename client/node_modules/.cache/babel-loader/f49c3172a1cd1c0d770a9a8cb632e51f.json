{"ast":null,"code":"import _asyncToGenerator from\"/Users/y-jacobmlo/Desktop/mentAllyFinal/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _defineProperty from\"/Users/y-jacobmlo/Desktop/mentAllyFinal/client/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/Users/y-jacobmlo/Desktop/mentAllyFinal/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/y-jacobmlo/Desktop/mentAllyFinal/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/y-jacobmlo/Desktop/mentAllyFinal/client/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useEffect,useContext}from\"react\";import axios from\"axios\";import{AuthContext}from\"../context/authContext\";import{useNavigate}from\"react-router-dom\";import moment from\"moment\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";function AdminChat(){var _useContext=useContext(AuthContext),currentUser=_useContext.currentUser;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),chats=_useState2[0],setChats=_useState2[1];var _useState3=useState({senderID:0,// sets senderID as the currentUsers ID which is referenced from DB.\nrecipientID:0,// set as 1 as recipient will always be Admin\nmessage:\"\",chatID:0,date:moment(Date.now()).format(\"YYYY-MM-DD HH:mm:ss\")}),_useState4=_slicedToArray(_useState3,2),inputs=_useState4[0],setInputs=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),modalOpen=_useState6[0],setModalOpen=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),adminMessages=_useState8[0],setAdminMessages=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),userView=_useState10[0],setUserView=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),err=_useState12[0],setError=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),sqlSurvey=_useState14[0],setSqlSurvey=_useState14[1];var navigate=useNavigate();useEffect(function(){if(currentUser.role!==1||currentUser.id!==4||currentUser===0){navigate(\"/\");}},[]);var handleChange=function handleChange(e){setInputs(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},e.target.name,e.target.value));});};var renderChats=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.post(\"/admin/obtainChats\").then(function(response){console.log(response.data);setChats(response.data);}).catch(function(error){console.log(error);});case 2:case\"end\":return _context.stop();}}},_callee);}));return function renderChats(){return _ref.apply(this,arguments);};}();var getSurvey=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.post(\"/contact/grabData\").then(function(response){console.log(response.data);setSqlSurvey(response.data);}).catch(function(error){console.log(error);});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function getSurvey(){return _ref2.apply(this,arguments);};}();useEffect(function(){getSurvey();});var reRender=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.post(\"/chat/obtain\",inputs).then(function(response){console.log(response.data);setUserView(response.data);}).catch(function(error){console.error(error);});case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function reRender(){return _ref3.apply(this,arguments);};}();var reRenderAdmin=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return axios.post(\"/chat/obtainAdmin\",{chatID:inputs.chatID}).then(function(response){console.log(response.data);setAdminMessages(response.data);}).catch(function(error){console.error(error);});case 2:case\"end\":return _context4.stop();}}},_callee4);}));return function reRenderAdmin(){return _ref4.apply(this,arguments);};}();useEffect(function(){renderChats();setInterval(function(){renderChats();},10000);},[]);var sendMessage=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:setInputs(function(prev){return _objectSpread(_objectSpread({},prev),{},{date:moment(Date.now()).format(\"YYYY-MM-DD HH:mm:ss\")});});_context5.next=3;return axios.post(\"/admin/sendMessage\",inputs,{}).then(function(response){return console.log(response);});case 3:case\"end\":return _context5.stop();}}},_callee5);}));return function sendMessage(){return _ref5.apply(this,arguments);};}();var handleSubmit=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;setInputs(function(prev){return _objectSpread(_objectSpread({},prev),{},{message:document.getElementById(\"messageinput\").value});});_context6.next=4;return sendMessage(inputs);case 4:document.getElementById(\"messageinput\").value=\"\";navigate(\"/admDash\");setInputs({chatID:0,recipientID:0,senderID:0});_context6.next=13;break;case 9:_context6.prev=9;_context6.t0=_context6[\"catch\"](0);setError(_context6.t0.response);console.log(_context6.t0);case 13:case\"end\":return _context6.stop();}}},_callee6,null,[[0,9]]);}));return function handleSubmit(){return _ref6.apply(this,arguments);};}();if(currentUser===0){return navigate(\"/\");}if(currentUser.id!==4){return navigate(\"/\");}return/*#__PURE__*/_jsxs(\"section\",{class:\"bg-ally7 p-5\",children:[/*#__PURE__*/_jsx(\"div\",{id:\"Chat\",class:\"grid grid-cols-3 gap-5\",children:chats.map(function(props){return/*#__PURE__*/_jsx(\"section\",{class:\"border border-ally10 rounded-lg p-5\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h4\",{class:\"font-bold text-ally2\",children:[\"Name: \",props.username]}),\"  \",/*#__PURE__*/_jsxs(\"h5\",{class:\"text-gray-600\",children:[\"Flag: \",props.flag]}),\"  \",/*#__PURE__*/_jsxs(\"h5\",{class:\"text-gray-600\",children:[\"chatId: \",props.id]}),\"  \",/*#__PURE__*/_jsx(\"input\",{id:\"chatID\",type:\"hidden\",value:props.id}),/*#__PURE__*/_jsx(\"input\",{id:\"recipientID\",type:\"hidden\",value:props.id}),/*#__PURE__*/_jsx(\"button\",{class:\"bg-ally2 hover:bg-ally1 text-white font-bold py-4 px-4 rounded mt-5\",onClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:setInputs({chatID:props.id,recipientID:props.id,senderID:props.id,date:moment(Date.now()).format(\"YYYY-MM-DD HH:mm:ss\")});reRender();reRenderAdmin();case 3:case\"end\":return _context7.stop();}}},_callee7);})),children:\"Load Messages\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{class:\"bg-ally2 hover:bg-ally1 text-white font-bold py-4 px-4 rounded mt-5\",onClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:setInputs({chatID:props.id,recipientID:props.id,senderID:props.id,date:moment(Date.now()).format(\"YYYY-MM-DD HH:mm:ss\")});reRender();reRenderAdmin();setModalOpen(true);case 4:case\"end\":return _context8.stop();}}},_callee8);})),children:\"View Chat\"})]})});})}),/*#__PURE__*/_jsxs(\"div\",{class:\"bg-ally7 p-5\",children:[/*#__PURE__*/_jsx(\"h4\",{class:\"font-bold text-ally2 mb-5\",children:\"Survey Answers\"}),sqlSurvey.map(function(props){return/*#__PURE__*/_jsxs(\"section\",{class:\"border border-ally10 rounded-lg p-5 mb-5\",children:[/*#__PURE__*/_jsx(\"div\",{class:\"text-ally10\",children:\"Name:\"}),/*#__PURE__*/_jsx(\"div\",{class:\"text-ally9\",children:\" \"}),\" \",props.fullName,\",\",/*#__PURE__*/_jsxs(\"div\",{class:\"text-ally8\",children:[\"Q1: \",props.q1,\", Q2: \",props.q2,\", Q3: \",props.q3,\", Q4: \",props.q4,\", Q5: \",props.q5,\", Q6: \",props.q6,\", Q7: \",props.q7,\", Q8: \",props.q8,\", Q9: \",props.q9]})]},props.id);})]}),modalOpen&&/*#__PURE__*/_jsxs(\"div\",{class:\"fixed bottom-0 inset-x-0 px-4 pb-4 sm:inset-0 sm:flex lg:items-center lg:justify-center\",children:[/*#__PURE__*/_jsx(\"div\",{class:\"fixed inset-0 transition-opacity\",children:/*#__PURE__*/_jsx(\"div\",{class:\"absolute inset-0 bg-gray-500 opacity-75\"})}),/*#__PURE__*/_jsxs(\"div\",{class:\"bg-ally7 rounded-lg px-4 pt-5 pb-4 overflow-hidden shadow-xl transform transition-all lg:max-w-lg lg:w-full\",role:\"dialog\",\"aria-modal\":\"true\",\"aria-labelledby\":\"modal-headline\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{class:\"text-lg leading-6 font-medium text-ally10\",id:\"modal-headline\",children:\"Chat details\"}),/*#__PURE__*/_jsxs(\"div\",{class:\"mt-2\",children:[/*#__PURE__*/_jsx(\"p\",{class:\"text-sm leading-5 text-gray-500\",children:\"Here you can see all the details of the chat.\"}),/*#__PURE__*/_jsx(\"div\",{id:\"Chat\",className:\"overflow-y-auto h-64\",children:adminMessages.concat(userView).sort(function(a,b){return new Date(a.date)-new Date(b.date);}).map(function(message){return/*#__PURE__*/_jsxs(\"div\",{className:\"chat flex items-start mt-4 \".concat(message.id===4?\"justify-end\":\"justify-start\"),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-bubble p-1 rounded \".concat(message.username===\"user\"?\"bg-ally10 text-white\":\"bg-ally10 text-white\"),children:[message.username,\": \",message.message,/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"p\",{class:\"px-1\",children:[\"Sent at\",\" \",new Date(message.date).toLocaleDateString(),\" \",new Date(message.date).toLocaleTimeString()]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-between mt-4\"})]},message.id);})})]})]}),/*#__PURE__*/_jsx(\"div\",{class:\"mt-5 sm:mt-6\",children:/*#__PURE__*/_jsxs(\"span\",{class:\"flex w-full rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"messageinput\",name:\"message\",className:\"w-3/4 p-1 border border-ally2\",onChange:handleChange}),/*#__PURE__*/_jsx(\"button\",{id:\"messagesubmit\",type:\"submit\",onClick:function onClick(){setInputs({chatID:inputs.chatID,recipientID:inputs.chatID,senderID:4});handleSubmit();setModalOpen(false);},className:\"p-2 border border-gray-300 bg-ally8 text-white ml-3\",children:\"Send\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",class:\"inline-flex justify-center w-full rounded-md border border-transparent px-4 py-2 bg-ally2 text-base leading-6 font-medium text-white shadow-sm hover:bg-ally1 focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo transition ease-in-out duration-150 sm:text-sm sm:leading-5 ml-3\",onClick:function onClick(){setModalOpen(false);setInputs({chatID:0,recipientID:0,senderID:0});},children:\"Close\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{className:\"ml-3\",children:\"Scroll Down\"})]})})]})]})]});}export default AdminChat;","map":{"version":3,"sources":["/Users/y-jacobmlo/Desktop/mentAllyFinal/client/src/pages/adminDash.jsx"],"names":["React","useState","useEffect","useContext","axios","AuthContext","useNavigate","moment","AdminChat","currentUser","chats","setChats","senderID","recipientID","message","chatID","date","Date","now","format","inputs","setInputs","modalOpen","setModalOpen","adminMessages","setAdminMessages","userView","setUserView","err","setError","sqlSurvey","setSqlSurvey","navigate","role","id","handleChange","e","prev","target","name","value","renderChats","post","then","response","console","log","data","catch","error","getSurvey","reRender","reRenderAdmin","setInterval","sendMessage","handleSubmit","document","getElementById","map","props","username","flag","fullName","q1","q2","q3","q4","q5","q6","q7","q8","q9","concat","sort","a","b","toLocaleDateString","toLocaleTimeString"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\nimport axios from \"axios\";\nimport { AuthContext } from \"../context/authContext\";\nimport { useNavigate } from \"react-router-dom\";\nimport moment from \"moment\";\n\nfunction AdminChat() {\n  const { currentUser } = useContext(AuthContext);\n  const [chats, setChats] = useState([]);\n  const [inputs, setInputs] = useState({\n    senderID: 0, // sets senderID as the currentUsers ID which is referenced from DB.\n    recipientID: 0, // set as 1 as recipient will always be Admin\n    message: \"\",\n    chatID: 0,\n    date: moment(Date.now()).format(\"YYYY-MM-DD HH:mm:ss\"),\n  });\n  const [modalOpen, setModalOpen] = useState(false);\n  const [adminMessages, setAdminMessages] = useState([]);\n  const [userView, setUserView] = useState([]);\n  const [err, setError] = useState(null);\n  const [sqlSurvey, setSqlSurvey] = useState([]);\n\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    if (\n      currentUser.role !== 1 ||\n      currentUser.id !== 4 ||\n      currentUser === 0\n    ) {\n      navigate(\"/\");\n    }\n  }, []);\n\n  const handleChange = (e) => {\n    setInputs((prev) => ({ ...prev, [e.target.name]: e.target.value }));\n  };\n\n  const renderChats = async () => {\n    await axios\n      .post(\"/admin/obtainChats\")\n      .then((response) => {\n        console.log(response.data);\n        setChats(response.data);\n      })\n      .catch((error) => {\n        console.log(error);\n      });\n  };\n\n  const getSurvey = async () => {\n    await axios\n    .post(\"/contact/grabData\")\n    .then((response) => {\n      console.log(response.data);\n      setSqlSurvey(response.data);\n    })\n    .catch((error) => {\n      console.log(error)\n    })\n  }\n\n  useEffect(() => {\n    getSurvey()\n  })\n\n  const reRender = async () => {\n    await axios\n      .post(\"/chat/obtain\", inputs)\n      .then((response) => {\n        console.log(response.data);\n        setUserView(response.data);\n      })\n      .catch((error) => {\n        console.error(error);\n      });\n  };\n\n  const reRenderAdmin = async () => {\n    await axios\n      .post(\"/chat/obtainAdmin\", {\n        chatID: inputs.chatID,\n      })\n      .then((response) => {\n        console.log(response.data);\n        setAdminMessages(response.data);\n      })\n      .catch((error) => {\n        console.error(error);\n      });\n  };\n\n  useEffect(() => {\n    renderChats();\n    setInterval(() => {\n      renderChats();\n    }, 10000);\n  }, []);\n\n\n\n\n\n  const sendMessage = async () => {\n    setInputs((prev) => ({ ...prev, date: moment(Date.now()).format(\"YYYY-MM-DD HH:mm:ss\") }));\n    await axios\n      .post(\"/admin/sendMessage\", inputs, {})\n      .then((response) => console.log(response));\n  };\n\n  const handleSubmit = async () => {\n    try {\n      setInputs((prev) => ({ ...prev, message: document.getElementById(\"messageinput\").value }));\n      await sendMessage(inputs);\n      document.getElementById(\"messageinput\").value = \"\";\n      navigate(\"/admDash\");\n      setInputs({chatID: 0, recipientID: 0, senderID: 0})\n    } catch (err) {\n      setError(err.response);\n      console.log(err);\n    }\n  };\n\n  if (currentUser === 0) {\n    return navigate(\"/\");\n  }\n\n  if (currentUser.id !== 4) {\n    return navigate(\"/\");\n  }\n\n\n  return (\n    <section class=\"bg-ally7 p-5\">\n     <div id=\"Chat\" class=\"grid grid-cols-3 gap-5\">\n        {chats.map((props) => (\n          <section class=\"border border-ally10 rounded-lg p-5\">\n            <div>\n              <h4 class=\"font-bold text-ally2\">Name: {props.username}</h4>\n              {\"  \"}\n              <h5 class=\"text-gray-600\">Flag: {props.flag}</h5>\n              {\"  \"}\n              <h5 class=\"text-gray-600\">chatId: {props.id}</h5>\n              {\"  \"}\n              <input id=\"chatID\" type=\"hidden\" value={props.id} />\n              <input id=\"recipientID\" type=\"hidden\" value={props.id} />\n              <button\n  class=\"bg-ally2 hover:bg-ally1 text-white font-bold py-4 px-4 rounded mt-5\"\n  onClick={async () => {\n    setInputs({\n      chatID: props.id,\n      recipientID: props.id,\n      senderID: props.id,\n      date: moment(Date.now()).format(\"YYYY-MM-DD HH:mm:ss\"),\n    });\n    reRender();\n    reRenderAdmin();\n  }}\n>\n  Load Messages\n</button>\n<br></br>\n<button \n  class=\"bg-ally2 hover:bg-ally1 text-white font-bold py-4 px-4 rounded mt-5\"\n  onClick={async () => {\n    setInputs({\n      chatID: props.id,\n      recipientID: props.id,\n      senderID: props.id,\n      date: moment(Date.now()).format(\"YYYY-MM-DD HH:mm:ss\"),\n    });\n    reRender();\n    reRenderAdmin();\n    setModalOpen(true);\n  }}\n>\n  View Chat\n</button>\n\n            </div>\n          </section>\n        ))}\n      </div>\n    <div class=\"bg-ally7 p-5\">\n  <h4 class=\"font-bold text-ally2 mb-5\">Survey Answers</h4>\n  {sqlSurvey.map((props) => (\n    <section key={props.id} class=\"border border-ally10 rounded-lg p-5 mb-5\">\n      <div class=\"text-ally10\">\n        Name:</div> \n        <div class=\"text-ally9\"> </div> {props.fullName},<div class=\"text-ally8\">Q1: {props.q1}, Q2: {props.q2}, Q3: {props.q3},  \n        Q4: {props.q4}, Q5: {props.q5}, Q6: {props.q6}, Q7: {props.q7}, Q8: {props.q8}, Q9: {props.q9}</div> \n     \n    </section>\n  ))}\n</div>\n\n\n      {modalOpen && (\n        <div class=\"fixed bottom-0 inset-x-0 px-4 pb-4 sm:inset-0 sm:flex lg:items-center lg:justify-center\">\n          <div class=\"fixed inset-0 transition-opacity\">\n            <div class=\"absolute inset-0 bg-gray-500 opacity-75\"></div>\n          </div>\n\n          <div\n            class=\"bg-ally7 rounded-lg px-4 pt-5 pb-4 overflow-hidden shadow-xl transform transition-all lg:max-w-lg lg:w-full\"\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-labelledby=\"modal-headline\"\n          >\n            <div>\n              <h3\n                class=\"text-lg leading-6 font-medium text-ally10\"\n                id=\"modal-headline\"\n              >\n                Chat details\n              </h3>\n              <div class=\"mt-2\">\n                <p class=\"text-sm leading-5 text-gray-500\">\n                  Here you can see all the details of the chat.\n                </p>\n                <div id=\"Chat\" className=\"overflow-y-auto h-64\">\n                  {adminMessages\n                    .concat(userView)\n                    .sort((a, b) => new Date(a.date) - new Date(b.date))\n                    .map((message) => (\n                      <div\n                        key={message.id}\n                        className={`chat flex items-start mt-4 ${\n                          message.id === 4 ? \"justify-end\" : \"justify-start\"\n                        }`}\n                      >\n                        <div\n                          className={`chat-bubble p-1 rounded ${\n                            message.username === \"user\"\n                              ? \"bg-ally10 text-white\"\n                              : \"bg-ally10 text-white\"\n                          }`}\n                        >\n                          {message.username}: {message.message}\n                          <br />\n                          <p class=\"px-1\">\n                            Sent at{\" \"}\n                            {new Date(message.date).toLocaleDateString()}{\" \"}\n                            {new Date(message.date).toLocaleTimeString()}\n                          </p>\n                        </div>\n                        <div className=\"flex justify-between mt-4\"></div>\n                      </div>\n                    ))}\n                </div>\n              </div>\n            </div>\n            <div class=\"mt-5 sm:mt-6\">\n              <span class=\"flex w-full rounded-md shadow-sm\">\n                <input\n                  type=\"text\"\n                  id=\"messageinput\"\n                  name=\"message\"\n                  className=\"w-3/4 p-1 border border-ally2\"\n                  onChange={handleChange}\n                />\n              <button id=\"messagesubmit\"\n                  type=\"submit\"\n                  onClick={() => {\n                    setInputs({\n                      chatID: inputs.chatID,\n                      recipientID: inputs.chatID,\n                      senderID: 4,\n                    });\n                    handleSubmit();\n                    setModalOpen(false);\n                  }}\n                  className=\"p-2 border border-gray-300 bg-ally8 text-white ml-3\"\n                >\n                  Send\n                </button> \n<button\n                  type=\"button\"\n                  class=\"inline-flex justify-center w-full rounded-md border border-transparent px-4 py-2 bg-ally2 text-base leading-6 font-medium text-white shadow-sm hover:bg-ally1 focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo transition ease-in-out duration-150 sm:text-sm sm:leading-5 ml-3\"\n                  onClick={() => {\n                    setModalOpen(false)\n                    setInputs({chatID: 0, recipientID: 0, senderID: 0});}\n                  }\n                >\n                  Close\n                </button><br/>\n<button className=\"ml-3\">Scroll Down</button>\n\n              </span>\n            </div>\n          </div>\n        </div>\n      )}\n    </section>\n  );\n}\n\nexport default AdminChat;\n"]},"metadata":{},"sourceType":"module"}