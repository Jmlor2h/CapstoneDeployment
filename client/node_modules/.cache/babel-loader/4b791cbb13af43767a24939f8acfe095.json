{"ast":null,"code":"import _asyncToGenerator from\"/Users/y-jacobmlo/Desktop/mentAllyFinal/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _defineProperty from\"/Users/y-jacobmlo/Desktop/mentAllyFinal/client/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/Users/y-jacobmlo/Desktop/mentAllyFinal/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/y-jacobmlo/Desktop/mentAllyFinal/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/y-jacobmlo/Desktop/mentAllyFinal/client/node_modules/@babel/runtime/regenerator/index.js\";import React from\"react\";import{useContext}from\"react\";import{AuthContext}from\"../context/authContext\";import moment from\"moment\";import{useState,useEffect}from\"react\";import axios from\"axios\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Chat(){var _useContext=useContext(AuthContext),currentUser=_useContext.currentUser;var _useState=useState({senderID:currentUser.id,// sets senderID as the currentUsers ID which is referenced from DB.\nrecipientID:4,// set as 1 as recipient will always be Admin\nmessage:\"\",chatID:currentUser.id,date:moment(Date.now()).format(\"YYYY-MM-DD HH:mm:ss\")}),_useState2=_slicedToArray(_useState,2),inputs=_useState2[0],setInputs=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),userView=_useState4[0],setUserView=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),err=_useState6[0],setError=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),adminMessages=_useState8[0],setAdminMessages=_useState8[1];var navigate=useNavigate();var handleChange=function handleChange(e){setInputs(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},e.target.name,e.target.value));});};// TODOS\nvar sendMessage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.post(\"/chat/sendMessage\",inputs,{}).then(function(response){return console.log(response);});case 2:case\"end\":return _context.stop();}}},_callee);}));return function sendMessage(){return _ref.apply(this,arguments);};}();var reRender=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.post(\"/chat/obtain\",inputs).then(function(response){console.log(response.data);setUserView(response.data);}).catch(function(error){console.error(error);});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function reRender(){return _ref2.apply(this,arguments);};}();var reRenderAdmin=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.post(\"/chat/obtainAdmin\",{chatID:currentUser.id}).then(function(response){console.log(response.data);setAdminMessages(response.data);}).catch(function(error){console.error(error);});case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function reRenderAdmin(){return _ref3.apply(this,arguments);};}();var handleSubmit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:e.preventDefault();_context4.prev=1;_context4.next=4;return sendMessage(inputs);case 4:document.getElementById('messageinput').value=\"\";_context4.next=11;break;case 7:_context4.prev=7;_context4.t0=_context4[\"catch\"](1);setError(_context4.t0.response.data);console.log(_context4.t0);case 11:case\"end\":return _context4.stop();}}},_callee4,null,[[1,7]]);}));return function handleSubmit(_x){return _ref4.apply(this,arguments);};}();// Define function to update chat div with messages\nuseEffect(function(){reRender();reRenderAdmin();setInterval(function(){reRender();reRenderAdmin();},10000);},[]);var scrollToBottom=function scrollToBottom(id){var element=document.getElementById(id);element.scrollTop=element.scrollHeight;};useEffect(function(){scrollToBottom(\"Chat\");});return/*#__PURE__*/_jsxs(\"section\",{className:\"p-6 bg-ally7\",children:[/*#__PURE__*/_jsx(\"div\",{id:\"Chat\",className:\"overflow-y-auto h-64\",children:userView.concat(adminMessages).sort(function(a,b){return new Date(a.date)-new Date(b.date);}).map(function(message){return/*#__PURE__*/_jsx(\"div\",{className:\"chat flex items-start mt-4 \".concat(message.id===4?'justify-end':'justify-start'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat-bubble p-3 rounded \".concat(message.username==='user'?'bg-ally10 text-white':'bg-ally10 text-white'),children:[message.username,\": \",message.message,/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"p\",{class:\"px-1\",children:[\"Sent at \",new Date(message.date).toLocaleDateString(),\" \",new Date(message.date).toLocaleTimeString()]})]})},message.id);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between mt-4\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"messageinput\",name:\"message\",className:\"w-3/4 p-2 border border-ally2\",onChange:handleChange}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",onClick:handleSubmit,className:\"p-2 border border-gray-300 bg-ally8 text-white\",children:\"Send\"})]})]});}export default Chat;","map":{"version":3,"sources":["/Users/y-jacobmlo/Desktop/mentAllyFinal/client/src/pages/Chat.jsx"],"names":["React","useContext","AuthContext","moment","useState","useEffect","axios","useNavigate","Chat","currentUser","senderID","id","recipientID","message","chatID","date","Date","now","format","inputs","setInputs","userView","setUserView","err","setError","adminMessages","setAdminMessages","navigate","handleChange","e","prev","target","name","value","sendMessage","post","then","response","console","log","reRender","data","catch","error","reRenderAdmin","handleSubmit","preventDefault","document","getElementById","setInterval","scrollToBottom","element","scrollTop","scrollHeight","concat","sort","a","b","map","username","toLocaleDateString","toLocaleTimeString"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { useContext } from \"react\";\nimport { AuthContext } from \"../context/authContext\";\nimport moment from \"moment\";\nimport { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { useNavigate } from \"react-router-dom\";\n\n\n\n\n\nfunction Chat() {\n  const { currentUser } = useContext(AuthContext);\n  const [inputs, setInputs] = useState({\n    senderID: currentUser.id, // sets senderID as the currentUsers ID which is referenced from DB.\n    recipientID: 4, // set as 1 as recipient will always be Admin\n    message: \"\",\n    chatID: currentUser.id,\n    date: moment(Date.now()).format(\"YYYY-MM-DD HH:mm:ss\"),\n  });\n\n  const [userView, setUserView] = useState([]);\n\n  const [err, setError] = useState(null);\n\n  const [adminMessages, setAdminMessages] = useState([]);\n  const navigate = useNavigate();\n\n  const handleChange = (e) => {\n    setInputs((prev) => ({ ...prev, [e.target.name]: e.target.value }));\n  };\n\n  // TODOS\n  const sendMessage = async () => {\n    await axios\n      .post(\"/chat/sendMessage\", inputs, {})\n      .then((response) => console.log(response));\n  };\n\nconst reRender = async () => {\n  await axios.post(\"/chat/obtain\", inputs)\n  .then(response => {\n    console.log(response.data)\n    setUserView(response.data)\n  })\n  .catch(error => {\n    console.error(error)\n  })\n};\n\nconst reRenderAdmin = async () => {\n    await axios.post(\"/chat/obtainAdmin\", {\n      chatID: currentUser.id\n    })\n    .then(response => {\n      console.log(response.data)\n      setAdminMessages(response.data)\n    })\n    .catch(error => {\n      console.error(error)\n    })\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    try {\n      await sendMessage(inputs);\n      document.getElementById('messageinput').value = \"\";\n    } catch (err) {\n      setError(err.response.data);\n      console.log(err);\n    }\n  };\n\n  // Define function to update chat div with messages\n  useEffect(() => {\n    reRender();\n    reRenderAdmin();\n    setInterval(() => {\n      reRender();\n      reRenderAdmin();\n    }, 10000);\n  }, []);\n\n  const scrollToBottom = (id) => {\n    const element = document.getElementById(id);\n    element.scrollTop = element.scrollHeight;\n}\n\nuseEffect(()=> {\n  scrollToBottom(`Chat`)\n})\n\n  return (\n    <section className=\"p-6 bg-ally7\">\n      <div id=\"Chat\" className=\"overflow-y-auto h-64\">\n        {userView.concat(adminMessages).sort((a,b) => new Date(a.date) - new Date(b.date)).map(message => (\n          <div key={message.id} className={`chat flex items-start mt-4 ${message.id === 4 ? 'justify-end' : 'justify-start'}`}>\n            <div className={`chat-bubble p-3 rounded ${message.username === 'user' ? 'bg-ally10 text-white' : 'bg-ally10 text-white'}`}>\n              {message.username}: {message.message}<br/>\n              <p class=\"px-1\">Sent at {new Date(message.date).toLocaleDateString()} {new Date(message.date).toLocaleTimeString()}</p>\n            </div>\n          </div>\n        ))}\n      </div>\n      <div className=\"flex justify-between mt-4\">\n        <input type=\"text\" id=\"messageinput\" name=\"message\" className=\"w-3/4 p-2 border border-ally2\" onChange={handleChange} />\n        <button type=\"submit\" onClick={handleSubmit} className=\"p-2 border border-gray-300 bg-ally8 text-white\">Send</button>\n      </div>\n    </section>\n  );\n\n\n}\n\nexport default Chat;\n"]},"metadata":{},"sourceType":"module"}